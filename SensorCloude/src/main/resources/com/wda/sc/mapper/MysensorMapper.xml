<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wda.sc.mapper.MysensorMapper">

	<select id="getList" resultType="com.wda.sc.domain.MysensorVO">
	<![CDATA[
    select x.rnum, x.* from
    ( select rownum as rnum, p.* from
    ( select c.sensor_sn, c.model_name, c.sensor_kind, c.manufacturer, c.voltage, c.create_day, c.site_id, s.site_name
    from (select my_sensor.sensor_sn, my_sensor.model_name, my_sensor.sensor_kind, my_sensor.manufacturer, my_sensor.voltage, substr(my_sensor.create_day,0,14) as create_day, install_sensor.site_id
    from my_sensor FULL OUTER JOIN install_sensor
    on my_sensor.sensor_sn = install_sensor.sensor_sn) c  LEFT OUTER JOIN site s
    on c.site_id = s.site_id 
    order by create_day desc ) p where rownum < #{endnum}) x
    where x.rnum >= #{startnum}
    order by x.create_day desc
    ]]>
	</select>

	<insert id="insertmysensor" parameterType="com.wda.sc.domain.MysensorVO">
		insert into my_sensor(sensor_sn,model_name,sensor_kind,manufacturer,voltage,create_day) values(#{sensor_sn}, #{model_name},#{sensor_kind},#{manufacturer},#{voltage},sysdate)
	</insert>
	
	<select id="installSelect" resultType="com.wda.sc.domain.InstallSensorVO">
		select * from install_sensor where sensor_sn = #{sensor_sn}
	</select>

	<update id="modmysensor" parameterType="com.wda.sc.domain.MysensorVO">
		update my_sensor set sensor_sn=#{sensor_sn}, sensor_kind=#{sensor_kind}, 
		model_name=#{model_name}, voltage=#{voltage}, manufacturer=#{manufacturer} 
		where sensor_sn=#{sensor_sn} 
	</update>
 	
 	<select id="getPageNum" resultType="int">
		select count(sensor_sn) from my_sensor
	</select>
	
	<!-- 보유센서 검색 -->
	<select id="mysensorSearch" resultType="com.wda.sc.domain.MysensorVO">
		select * from my_sensor where ${searchType} LIKE '%' || '${keyword}' || '%'
	</select>
	
	<!-- 보유센서 검색 + 페이징 -->
	<select id="getSearchResult" resultType="com.wda.sc.domain.MysensorVO" parameterType="map">
	<![CDATA[	
	select x.rnum, x.* from
    ( select rownum as rnum, p.* from
    ( select c.sensor_sn, c.model_name, c.sensor_kind, c.manufacturer, c.voltage, c.create_day, c.site_id, s.site_name
    from (select my_sensor.sensor_sn, my_sensor.model_name, my_sensor.sensor_kind, my_sensor.manufacturer, my_sensor.voltage, substr(my_sensor.create_day,0,14) as create_day, install_sensor.site_id
    from my_sensor FULL OUTER JOIN install_sensor
    on my_sensor.sensor_sn = install_sensor.sensor_sn where ${Search.searchType} LIKE '%' || '${Search.keyword}' || '%') c  LEFT OUTER JOIN site s
    on c.site_id = s.site_id 
    order by create_day desc ) p where rownum < #{Paging.endnum}) x
    where x.rnum >= #{Paging.startnum}
    order by x.create_day desc
    ]]>
	</select>
</mapper>