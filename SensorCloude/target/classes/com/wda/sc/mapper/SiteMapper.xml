<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wda.sc.mapper.SiteMapper">

	<select id="getList" resultType="com.wda.sc.domain.SiteVO">
	<![CDATA[
		select site_id,type_no,site_name,address,site_status,substr(start_date,0,14) as start_date 
		from (select * from site order by site_status desc)
		where rownum < 17 
	]]>
	</select>

	<select id="getSite" resultType="com.wda.sc.domain.SiteVO">
		select * from site where site_id = #{site_id}
	</select>
	
	<select id="repairList" resultType="com.wda.sc.domain.CheckBoardVO" parameterType="map">
	<![CDATA[
	select x.rnum, x.* from
    (select rownum as rnum, p.* from
        (select c.board_no, m.name, c.user_id, c.title,c.reg_date,c.board_status,c.site_name 
         from (select board_no,check_board.user_id, check_board.title, substr(check_board.reg_date,0,14) as reg_date,check_board.board_status,check_board.site_id, site.site_name
               from check_board,site
               where check_board.site_id = site.site_id and check_board.site_id = #{site_id}) c,member m
         where c.user_id = m.user_id
         order by reg_date desc) p where rownum < #{paging.endnum}) x
	where x.rnum >= #{paging.startnum}
	order by x.reg_date desc
	]]>	 
	</select>
	
	<select id="getAlarm_member" resultType="com.wda.sc.domain.AlarmMemberVO">
		select name,tel,company from alarm_member where site_id = #{site_id}
	</select>
	
	<insert id="siteadd" parameterType="com.wda.sc.domain.SiteVO">
		insert into site(site_id,type_no,site_name,address,detail_address,start_date) values(#{site_id},#{type_no},#{site_name},#{address},#{detail_address},sysDate)
	</insert>
	
	<select id="getAlarm" resultType="com.wda.sc.domain.AlarmVO">
		select alarm_no,site_id,alarm_content,substr(alarm_time,0,14) as alarm_time,send_user from alarm where site_id = #{site_id}
	</select>
	
	<select id="getPageNum" resultType="int">
			select count(site_id) from site
	</select>
	
	<select id="repairPageNum" resultType="int">
			select count(site_id) from check_board where site_id = #{site_id}
	</select>
	
	<select id="getContent" resultType="com.wda.sc.domain.SiteVO" parameterType="com.wda.sc.domain.Paging">
		<![CDATA[
		select rownum, x.site_id as site_id,x.type_no as type_no,x.site_name as site_name ,x.address as address ,x.site_status as site_status ,x.start_date as start_date 
		from (select rownum as rnum,site_id,type_no,site_name,address,site_status,substr(start_date,0,14) as start_date
			  from (select * from site order by site_status desc) where rownum < #{endnum}) x
		where x.rnum >= #{startnum}
		order by x.site_status desc
		]]>
	</select>
	

	<insert id="insertAlarmMember" parameterType="com.wda.sc.domain.AlarmMemberVO">
		insert into alarm_member(alarm_m_no,site_id,tel,name,company) values('4', #{site_id},#{tel},#{name},#{company})
	</insert>
	
	<insert id="insertAlarm" parameterType="com.wda.sc.domain.AlarmVO">
		insert into alarm(alarm_no,site_id,alarm_content,alarm_time,send_user) values(alarm_seq.nextval, #{site_id},#{alarm_content},sysdate,#{send_user})
	</insert>
	
	<!--현장 추가 -->
	<insert id="insertsite" parameterType="com.wda.sc.domain.SiteVO">
		insert into site(site_id,type_no,site_name,address,start_date,site_status) values(#{site_id},#{type_no}, #{site_name},#{address},sysdate,#{site_status})
		insert into network(sig_id,site_id,sig_protocol,host_ip,sig_port_num,port_num) values(#{sig_id},#{site_id},#{sig_protocol},#{host_ip},#{sig_port_num},#{port_num})
	</insert>
</mapper>