<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="./css/search.css">
    <link rel="stylesheet" type="text/css" href="./css/jquery.mobile-1.4.5.css">
    <script src="./js/jquery.js"></script>
    <script src="./js/jquery.mobile-1.4.5.js"></script>
    
    
     <script>
            $(document).on('pagebeforeshow', function() {
                 $("#search-basic").textinput();      
             });

             $(document).keyup('#search-basic', function(){
                var text = $("#search-basic").val();   
                console.log(text);
                var searchword = {
                    word : text
                }
                var sendText = JSON.stringify(searchword);
                console.log()
                if( text != ''){
                    $.ajax({
                        type : 'POST',
                        url : "http://39.127.7.58:8080/app/mSearch.do",
                        data : sendText,
                        contentType : "application/json; charset=UTF-8",
                        success : function(result){

                            // var io = JSON.parse(result);
                            console.log(result);

                            var str="";
                            $.each(result,function(i,s){
        
                  str +='<tr>';
                  switch(s.type_no){
                  case '0' : str +='<td>'+ "<img src='img/gray.svg'>" +'</td>'; break;
                  case '1' : str +='<td>'+ "<img src='img/green.svg'>" +'</td>'; break;
                  case '2' : str +='<td>'+ "<img src='img/red.svg'>" +'</td>'; break;
                  default  : str +='<td>'+'null'+'</td>'; break;
                  }
                  str +='<td>'+s.site_name+'</td>';
                  str +='<td>'+s.address+'</td>';
                  str +='<td>'+s.start_date+'</td>';
                  str +='<td style="display : none">'+s.site_id+'</td>';
                  str +='</tr>';


                            $("#aaa").html(str);
                    });
                           
                        } //success 함수 종료
                    }); //ajax종료
                } else {
                      $("#aaa").empty(); 
                }


             });

             $(document).on('click', '.ui-input-clear', function () {
                //검색창 x버튼 클릭시
                $("#aaa").empty(); 
             });

              $(document).on("click", "#aaa tr" , function(){
                var tr = $("#aaa tr").index(this);
                var site_id = $("#aaa tr:eq("+tr+") td:eq(4)").text();
                window.location.href = "site.html?sid=" + site_id;
             });

    </script>
</head>
<body>
        <div data-role="page" id="index">
                <div data-role="header" data-position="fixed">
                    <img src="./img/str.png" width="30%" height="30%">
                </div>
                <div data-role="content">

                    <div data-role="fieldcontain">            
                        <input type="search" name="search" id="search-basic" value="" />
                    </div>

                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                        <tr>
                            <th>현재상태</th>
                            <th>현장이름</th>
                            <th>주소</th>
                            <th>데이터갱신시간</th>
                         </tr>
                    <tbody id="aaa">
                       
                    </tbody>
                 </table>
                 <ul class="pagination">
               
                </ul>
            </div>
        </div>
                <div data-role="footer"  data-position="fixed" data-id="footerid1">
                   <div data-role="navbar">
                      <ul>
                        <li><a href="main.html" rel="external" data-icon="home"></a></li>
                        <li><a href="search.html" rel="external" data-icon="search"></a></li>
                        <li><a href="timeline.html" rel="external" data-icon="comment"></a></li>
                        <li><a href="mypage.html" rel="external" data-icon="user"></a></li>
                      </ul>
                   </div>
                </div>
            </div>
</body>
</html>